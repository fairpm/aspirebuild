#!/usr/bin/env bash

# shellcheck disable=SC2086
source "$(dirname $0)"/../lib/bash/prelude.bash

builders=${ASPIREBUILD_BUILDER_DIR:-$ASPIREBUILD/builders}
mkdir -p "$builders"

builder=${1:-$(mktemp -d $builders/builder.XXXXXXXXXX)}

[[ $builder =~ ^/ ]] || builder=$builders/$builder

git clone . $builder/.aspirebuild > /dev/null
ln -s $builder $builder/.aspirebuild/builder

# should be deferred til later, e.g. in a Justfile, when it doesn't have to be silenced
# $__HERE/init-builder-flake $builder >/dev/null 2>&1

echo $builder
